const fs = require("fs");
const schema = require("../src/validation.schema.json");
const OUTPUT_FILE = "./src/SchemaDefinition.ts";

const reservedDefinitionNameFilterFn = (definition) => {
    return definition !== "ISchema" && definition !== "Schemas";
};

const definitions = Object.keys(schema.definitions).filter(reservedDefinitionNameFilterFn);

const importBuffer = definitions.map((definition) => {
    return `${definition}`;
});

const schemasBuffer = definitions.map((definition) => {
    return `"#/definitions/${definition}"`;
});

// export const schemas: Record<keyof ISchema, string> = {
//     ["Foo"]: "#path",
// };

const outputBuffer = [];
outputBuffer.push(`// THIS IS AN AUTOGENERATED FILE PLEASE DO NOT MODIFY MANUALLY`);

outputBuffer.push(`import {${importBuffer.join(", ")}} from "./Types";`);
outputBuffer.push("");

outputBuffer.push(`export const schemas: Record<keyof ISchema, string> = {`);
definitions.forEach((definition) => {
    outputBuffer.push(`    ["#/definitions/${definition}"]: "${definition}",`);
});
outputBuffer.push(`}`);

outputBuffer.push("");

outputBuffer.push("export interface ISchema {");

definitions.forEach((definition) => {
    outputBuffer.push(`    ["#/definitions/${definition}"]: ${definition},`);
});
outputBuffer.push("}");
outputBuffer.push("");

const output = outputBuffer.join("\n");

fs.writeFile(OUTPUT_FILE, output, { flag: "w" }, function (err) {
    if (err) {
        return console.log(err);
    }
});
